# デプロイメントチェックリスト

3-2-1-1-0 Backup Management System のLinux本番環境デプロイメント用チェックリスト

## 事前確認

### インフラストラクチャの準備

- [ ] サーバーのプロビジョニングが完了している
- [ ] OS（Ubuntu/Debian）がインストール済み
- [ ] インターネット接続が可能
- [ ] ファイアウォールがHTTP/HTTPSを許可している（ポート80、443）
- [ ] SSHアクセスが可能
- [ ] ディスク容量が十分（最低50GB）
- [ ] メモリが十分（最低4GB）

### DNS・ドメイン設定

- [ ] ドメイン名を取得している
- [ ] DNSレコード（A record）がサーバーのIPアドレスを指している
- [ ] DNS伝播を確認している（`nslookup backup.example.com`）
- [ ] DNSが正常に解決できることを確認

### セキュリティ

- [ ] SSHキーベース認証を設定している
- [ ] ファイアウォール（UFW）の設定計画がある
- [ ] バックアップ戦略を決定している
- [ ] ログ保持ポリシーを決定している

## セットアップフェーズ

### 前提条件チェック

- [ ] root または sudo アクセスがある
- [ ] Python 3.9以上がインストール済み（`python3 --version`）
- [ ] gitがインストール済み（`git --version`）
- [ ] Bashが使用可能（`bash --version`）

### アプリケーション展開

- [ ] リポジトリをクローンしている
- [ ] `setup.sh` に実行権限を付与している
- [ ] `sudo ./deployment/linux/setup.sh` を実行している
- [ ] セットアップが正常に完了している
- [ ] エラーがないことを確認している

### 環境変数設定

- [ ] `.env` ファイルが作成されている
- [ ] `SECRET_KEY` が設定されている
- [ ] `DATABASE_URL` が設定されている
- [ ] `BACKUP_DIR` が正しいパスに設定されている
- [ ] `LOG_FILE` が正しいパスに設定されている
- [ ] メール設定が完了している（必要に応じて）
- [ ] ファイルパーミッション600に設定されている

### データベース初期化

- [ ] データベーステーブルが作成されている
- [ ] `sqlite3` コマンドでテーブルを確認している
- [ ] 初期データが投入されている（必要に応じて）

## SSL/TLS設定

### 証明書取得

- [ ] Certbotがインストール済み
- [ ] `setup_ssl.sh` に実行権限を付与している
- [ ] `sudo ./deployment/linux/setup_ssl.sh` を実行している
- [ ] ドメイン名を入力している
- [ ] メールアドレスを入力している
- [ ] 証明書が正常に取得されている

### nginx設定

- [ ] nginxコンフィグが更新されている
- [ ] `server_name` がドメイン名に設定されている
- [ ] SSL証明書パスが正しい
- [ ] `nginx -t` でテストが成功している
- [ ] nginxが再起動されている

### 証明書の確認

- [ ] `certbot certificates` で証明書が表示される
- [ ] 証明書の有効期限を確認している
- [ ] 自動更新タイマーが有効になっている
- [ ] 更新テストが成功している（`certbot renew --dry-run`）

## サービス起動

### systemd設定

- [ ] systemdユニットが登録されている
- [ ] `systemctl status backup-management.service` でステータス確認
- [ ] サービスが `active (running)` 状態
- [ ] `systemctl enable backup-management.service` で自動起動を有効化

### nginx設定

- [ ] nginxが起動している（`systemctl status nginx`）
- [ ] nginxが `active (running)` 状態
- [ ] nginx設定が正しい（`nginx -t`）

### ログ確認

- [ ] アプリケーションログが生成されている
- [ ] エラーログに問題がない
- [ ] systemdログが正常（`journalctl -u backup-management.service`）
- [ ] nginxログが正常（`/var/log/nginx/error.log`）

## 動作確認

### 接続テスト

- [ ] ローカルHTTP接続でテスト（`curl http://127.0.0.1:5000`）
- [ ] ローカルHTTPS接続でテスト（`curl https://127.0.0.1 -k`）
- [ ] ブラウザから接続確認
- [ ] HTTPS接続で警告が出ていない（証明書が有効）

### 機能テスト

- [ ] ダッシュボードが表示される
- [ ] ログイン機能が動作する
- [ ] バックアップ設定ページが表示される
- [ ] バックアップジョブが実行できる
- [ ] ログが正常に記録されている

### パフォーマンステスト

- [ ] ページ読み込み速度が許容範囲
- [ ] メモリ使用率が正常
- [ ] ディスク I/O が正常
- [ ] CPU使用率が正常

## セキュリティ設定

### ファイアウォール

- [ ] UFWが有効（`ufw status`）
- [ ] SSHポート（22）が許可されている
- [ ] HTTPポート（80）が許可されている
- [ ] HTTPSポート（443）が許可されている
- [ ] 不要なポートは閉じられている

### アプリケーション権限

- [ ] アプリケーションユーザー（backupmgmt）が作成されている
- [ ] ファイルオーナーが正しく設定されている
- [ ] ファイルパーミッションが適切（755/644）
- [ ] .envファイルのパーミッションが600

### SSH設定

- [ ] キーベース認証を有効化している
- [ ] パスワード認証を無効化している（推奨）
- [ ] rootログインを無効化している（推奨）
- [ ] SSHポートを変更している（推奨）

## バックアップ・復旧

### バックアップ設定

- [ ] バックアップディレクトリが存在する（`/backup` など）
- [ ] バックアップディレクトリに十分な容量がある
- [ ] データベースのバックアップスクリプトがある
- [ ] ログのバックアップスクリプトがある

### 復旧テスト

- [ ] バックアップが正常に作成できる
- [ ] バックアップから復旧可能なことを確認
- [ ] 復旧手順がドキュメント化されている
- [ ] 復旧に必要な時間を測定している

## 監視・ログ

### ログ設定

- [ ] アプリケーションログが出力されている
- [ ] ログレベルが適切に設定されている
- [ ] ログファイルローテーションが設定されている
- [ ] 古いログが削除される設定になっている

### モニタリング

- [ ] ディスク使用率を監視する方法がある
- [ ] メモリ使用率を監視する方法がある
- [ ] CPU使用率を監視する方法がある
- [ ] エラーログの監視方法がある

### アラート設定

- [ ] ディスク満杯時のアラート
- [ ] サービス停止時のアラート
- [ ] SSL証明書期限切れ前のアラート
- [ ] エラーログ出力時のアラート

## ドキュメント

### セットアップドキュメント

- [ ] セットアップ手順がドキュメント化されている
- [ ] トラブルシューティングがドキュメント化されている
- [ ] アンインストール手順がドキュメント化されている
- [ ] 設定変更手順がドキュメント化されている

### 運用ドキュメント

- [ ] サービス管理コマンドがドキュメント化されている
- [ ] ログ確認方法がドキュメント化されている
- [ ] バックアップ・復旧手順がドキュメント化されている
- [ ] 緊急時の対応手順がドキュメント化されている

### 保守ドキュメント

- [ ] システム構成図がドキュメント化されている
- [ ] インフラストラクチャ情報がドキュメント化されている
- [ ] アカウント・パスワード管理がドキュメント化されている
- [ ] 定期メンテナンススケジュールがある

## デプロイ後の確認

### 最終確認

- [ ] 全てのサービスが起動している
- [ ] SSL証明書が有効である
- [ ] アプリケーションが正常に動作している
- [ ] バックアップが正常に実行される

### パフォーマンス基準

- [ ] CPU使用率: 10%未満（待機時）
- [ ] メモリ使用率: 512MB未満（待機時）
- [ ] ディスク使用率: 80%未満
- [ ] レスポンスタイム: 2秒以下

### セキュリティ基準

- [ ] HTTPSが強制されている
- [ ] セキュアなヘッダーが設定されている
- [ ] ログがセキュアに保存されている
- [ ] アクセスログに敏感情報が含まれていない

## 定期メンテナンス

### 日次

- [ ] ログを確認している
- [ ] エラーが発生していないことを確認
- [ ] サービスが起動していることを確認

### 週次

- [ ] バックアップが成功していることを確認
- [ ] ディスク使用率を確認
- [ ] セキュリティログを確認

### 月次

- [ ] システムアップデートをチェック
- [ ] パフォーマンスレポートを生成
- [ ] 証明書の有効期限を確認
- [ ] ログファイルをアーカイブ

### 年次

- [ ] セキュリティ監査を実施
- [ ] ディザスタリカバリテストを実施
- [ ] システムの容量計画をレビュー
- [ ] セキュリティパッチをレビュー

## 署名

| 項目 | 実施者 | 日時 | 確認者 |
|------|--------|------|--------|
| デプロイメント実施 | | | |
| セキュリティ確認 | | | |
| 動作確認 | | | |
| 本番環境リリース | | | |

---

**注記**: このチェックリストは全ての項目を確認してからデプロイメントを完了としてください。
不足している項目がある場合は、デプロイメントを開始せず、必要な準備を完了してください。
