{% extends "base.html" %}
{% block title %}レポート生成 - バックアップ管理システム{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3"><i class="bi bi-file-earmark-plus"></i> レポート生成</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">ホーム</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('reports.list') }}">レポート一覧</a></li>
                    <li class="breadcrumb-item active">生成</li>
                </ol>
            </nav>
        </div>
    </div>

    <form method="POST" action="{{ url_for('reports.generate') }}" id="report-form">
        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-gear"></i> レポート設定</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="report_type" class="form-label">レポートタイプ <span class="text-danger">*</span></label>
                            <select class="form-select" id="report_type" name="report_type" required>
                                <option value="periodic">定期レポート（日次/週次/月次）</option>
                                <option value="compliance">コンプライアンスレポート</option>
                                <option value="custom">カスタムレポート</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="period_start" class="form-label">対象期間（開始） <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="period_start" name="period_start" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="period_end" class="form-label">対象期間（終了） <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="period_end" name="period_end" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">含める情報</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_jobs" name="include_jobs" checked>
                                <label class="form-check-label" for="include_jobs">バックアップジョブ実行履歴</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_media" name="include_media" checked>
                                <label class="form-check-label" for="include_media">メディア使用状況</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_verification" name="include_verification" checked>
                                <label class="form-check-label" for="include_verification">検証テスト結果</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_compliance" name="include_compliance">
                                <label class="form-check-label" for="include_compliance">コンプライアンス準拠状況</label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="format" class="form-label">出力形式</label>
                            <select class="form-select" id="format" name="format">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel (XLSX)</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('reports.list') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> キャンセル
                            </a>
                            <button type="submit" class="btn btn-primary" id="generate-btn">
                                <i class="bi bi-file-earmark-arrow-down"></i> レポート生成
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> 生成情報</h5>
                    </div>
                    <div class="card-body">
                        <h6>推定レポートサイズ</h6>
                        <p class="text-muted">選択内容により変動</p>
                        <hr>
                        <h6>生成時間（目安）</h6>
                        <p class="text-muted">1-5分程度</p>
                        <hr>
                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb"></i>
                            <strong>ヒント:</strong>
                            <p class="mb-0 mt-2 small">
                                大量のデータを含む場合、レポート生成に時間がかかる場合があります。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
{% block extra_js %}
<script>
document.getElementById('period_end').valueAsDate = new Date();
const startDate = new Date();
startDate.setDate(startDate.getDate() - 30);
document.getElementById('period_start').valueAsDate = startDate;

document.getElementById('report-form').addEventListener('submit', function(e) {
    const btn = document.getElementById('generate-btn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>生成中...';
});
</script>
{% endblock %}
