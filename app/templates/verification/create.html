{% extends "base.html" %}
{% block title %}検証テスト記録 - バックアップ管理システム{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3"><i class="bi bi-plus-circle"></i> 検証テスト記録</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">ホーム</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('verification.list') }}">検証テスト一覧</a></li>
                    <li class="breadcrumb-item active">新規記録</li>
                </ol>
            </nav>
        </div>
    </div>

    <form method="POST" action="{{ url_for('verification.create') }}" novalidate>
        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> テスト基本情報</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="job_id" class="form-label">バックアップジョブ <span class="text-danger">*</span></label>
                                <select class="form-select" id="job_id" name="job_id" required>
                                    <option value="">選択してください</option>
                                    {% for job in jobs %}
                                    <option value="{{ job.id }}">{{ job.job_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="media_id" class="form-label">対象メディア</label>
                                <select class="form-select" id="media_id" name="media_id">
                                    <option value="">選択してください</option>
                                    {% for media in media_list %}
                                    <option value="{{ media.id }}">{{ media.media_id }} - {{ media.label_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="test_type" class="form-label">テストタイプ <span class="text-danger">*</span></label>
                                <select class="form-select" id="test_type" name="test_type" required>
                                    <option value="full">完全検証（全ファイル）</option>
                                    <option value="partial">部分検証（サンプリング）</option>
                                    <option value="quick">クイック検証（メタデータのみ）</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="test_date" class="form-label">実施日時 <span class="text-danger">*</span></label>
                                <input type="datetime-local" class="form-control" id="test_date" name="test_date" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="notes" class="form-label">備考</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> テスト結果</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="result" class="form-label">結果 <span class="text-danger">*</span></label>
                                <select class="form-select" id="result" name="result" required>
                                    <option value="passed">成功</option>
                                    <option value="failed">失敗</option>
                                    <option value="warning">警告あり</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="total_files" class="form-label">総ファイル数</label>
                                <input type="number" class="form-control" id="total_files" name="total_files" min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="files_verified" class="form-label">検証済ファイル数</label>
                                <input type="number" class="form-control" id="files_verified" name="files_verified" min="0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="errors_found" class="form-label">検出エラー数</label>
                                <input type="number" class="form-control" id="errors_found" name="errors_found" min="0" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="duration_minutes" class="form-label">所要時間（分）</label>
                                <input type="number" class="form-control" id="duration_minutes" name="duration_minutes" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('verification.list') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> キャンセル
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> 登録
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
{% block extra_js %}
<script>
document.getElementById('test_date').value = new Date().toISOString().slice(0, 16);
</script>
{% endblock %}
