# カスタムコマンドガイド
# 3-2-1-1-0 バックアップ管理システム

## 📋 概要

このプロジェクトでは、開発を効率化するためのカスタムClaude Codeコマンドを提供しています。

---

## 🚀 利用可能なコマンド

### 1. `/commit` - コミット＆プッシュ

**用途**: 変更をコミットしてリモートリポジトリにプッシュ

**実行内容:**
1. Git状態の確認（status, diff, log）
2. 適切なコミットメッセージの自動生成
3. 変更のステージング
4. コミット作成
5. リモートへのプッシュ

**使用例:**
```
/commit
```

**コミットメッセージ形式:**
```
[種類] 簡潔な変更内容

- 詳細な変更内容1
- 詳細な変更内容2
- 詳細な変更内容3

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**種類:**
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `refactor`: リファクタリング
- `test`: テスト
- `chore`: その他

---

### 2. `/pr` - プルリクエスト作成

**用途**: 既にプッシュ済みの変更に対してPRを作成

**前提条件:**
- 変更が既にコミット＆プッシュされていること
- `gh` コマンドが認証済みであること

**実行内容:**
1. ブランチ状態の確認
2. 変更内容の分析
3. PRタイトルとボディの自動生成
4. `gh pr create` の実行
5. PR URLの表示

**使用例:**
```
/pr
```

**PR構成:**
- 📋 概要
- ✨ 変更内容
- 🔧 主な変更ファイル
- ✅ テスト
- 📝 レビューポイント
- 🚀 デプロイ後確認事項

---

### 3. `/commit-and-pr` - コミット＆プッシュ＆PR作成

**用途**: 変更のコミットからPR作成までを一括実行

**実行内容:**
1. Git状態の確認
2. 変更の分析とコミット
3. リモートへのプッシュ
4. PRタイトルとボディの作成
5. PRの作成

**使用例:**
```
/commit-and-pr
```

**ワークフロー:**
```
変更確認 → コミット → プッシュ → PR作成 → URL表示
```

**適している場面:**
- feature ブランチでの作業完了時
- bugfix の完了時
- 新機能の実装完了時

---

## 📝 コマンドの仕組み

### コマンドファイルの場所

```
.claude/commands/
├── commit.md           # /commit コマンド
├── pr.md              # /pr コマンド
└── commit-and-pr.md   # /commit-and-pr コマンド
```

### コマンド実行の流れ

1. ユーザーが `/コマンド名` を入力
2. Claude Codeが対応する `.md` ファイルを読み込み
3. ファイル内の指示に従って自動実行
4. 結果をユーザーに表示

---

## 🎯 使い分けガイド

### シナリオ1: 作業途中の保存

**状況**: 作業途中だが、変更をバックアップしたい

**推奨コマンド**: `/commit`

```
/commit
```

**理由**: PRを作成せず、コミット＆プッシュのみ実行

---

### シナリオ2: 機能完成後のPR作成

**状況**: 既にコミット＆プッシュ済み、PRを作成したい

**推奨コマンド**: `/pr`

```
/pr
```

**理由**: コミット作業をスキップしてPR作成のみ実行

---

### シナリオ3: 機能完成、すぐにPR作成

**状況**: 機能が完成、コミットもPRも一気に行いたい

**推奨コマンド**: `/commit-and-pr`

```
/commit-and-pr
```

**理由**: すべてを一括で実行、最も効率的

---

## ⚙️ コマンドのカスタマイズ

### 独自のコマンドを追加

1. `.claude/commands/` に新しい `.md` ファイルを作成
2. コマンドの指示を記述
3. `/コマンド名` で実行

**例: `/test` コマンドを作成**

```markdown
<!-- .claude/commands/test.md -->
# テスト実行コマンド

以下のテストを実行してください:
1. 単体テスト: pytest tests/
2. カバレッジ: pytest --cov=app tests/
3. 結果のサマリー表示
```

使用:
```
/test
```

---

## 🔒 セキュリティ注意事項

### コミット前の確認

コマンド実行時、以下が自動的にチェックされます:

- [ ] 機密情報（トークン、APIキー）が含まれていないか
- [ ] `.env` ファイルが含まれていないか
- [ ] 一時ファイルが含まれていないか
- [ ] `.gitignore` が適切に設定されているか

### PRボディの注意点

- 機密情報を記載しない
- 内部のサーバー名やIPアドレスを記載しない
- パスワードやトークンを記載しない

---

## 🐛 トラブルシューティング

### 問題1: コマンドが見つからない

**症状**: `/commit` を入力しても反応がない

**解決策**:
1. VSCodeを再起動
2. `.claude/commands/` ディレクトリが存在するか確認
3. コマンドファイルが `.md` 拡張子か確認

### 問題2: PR作成に失敗

**症状**: `gh pr create` がエラーを返す

**解決策**:
```bash
# GitHub認証を確認
gh auth status

# 必要に応じて再認証
gh auth login
```

### 問題3: コミットメッセージが日本語で表示されない

**症状**: コミットメッセージが文字化け

**解決策**:
```bash
# Git設定を確認
git config --global core.quotepath false
git config --global i18n.commitencoding utf-8
git config --global i18n.logoutputencoding utf-8
```

---

## 📚 コマンドリファレンス

### コミットメッセージのベストプラクティス

**良い例:**
```
feat: バックアップジョブスケジューラーを追加

- APSchedulerによる定期実行機能を実装
- Cron形式のスケジュール設定をサポート
- ジョブ実行履歴の保存機能を追加
```

**悪い例:**
```
update
```

### PRタイトルのベストプラクティス

**良い例:**
```
feat: 3-2-1-1-0ルール自動チェック機能を追加
```

**悪い例:**
```
update
```

---

## 🎓 高度な使い方

### 複数のファイルを段階的にコミット

```
# ステップ1: 特定のファイルのみコミット
git add file1.py file2.py
/commit

# ステップ2: 残りのファイルをコミット
git add .
/commit
```

### ドラフトPRの作成

`/pr` コマンド実行時に、以下を指示:

```
ドラフトPRとして作成してください（--draftオプション使用）
```

### 複数のIssueをクローズするPR

PRボディに以下を追加:

```markdown
Closes #123, #124, #125
```

---

## 📊 コマンド使用統計

定期的に以下をレビューすることを推奨します:

```bash
# コミット履歴の確認
git log --oneline --graph --all --decorate

# PRの一覧
gh pr list --state all

# 最近のコミット統計
git shortlog -sn --since="1 month ago"
```

---

## 🔄 ワークフロー例

### 典型的な開発フロー

```
1. feature ブランチを作成
   git checkout -b feature/new-scheduler

2. コードを実装
   [実装作業]

3. 定期的にコミット
   /commit

4. 機能完成後、PRを作成
   /pr

5. レビュー後、マージ
   [GitHub上でマージ]
```

### ホットフィックスフロー

```
1. hotfix ブランチを作成
   git checkout -b hotfix/critical-bug

2. バグ修正
   [修正作業]

3. コミット＆PRを一括作成
   /commit-and-pr

4. 緊急マージ
   [GitHub上で緊急マージ]
```

---

## ✅ チェックリスト

コマンド実行前に確認:

**コミット前:**
- [ ] 変更内容を理解している
- [ ] 不要なファイルが含まれていない
- [ ] テストが通る
- [ ] ビルドエラーがない

**PR作成前:**
- [ ] コミットが適切に整理されている
- [ ] PRの説明が明確
- [ ] レビュアーが理解できる内容
- [ ] 関連Issueをリンク

---

## 📧 サポート

問題や質問がある場合:

- **Issues**: https://github.com/Kensan196948G/backup-management-system/issues
- **Discussions**: https://github.com/Kensan196948G/backup-management-system/discussions

---

**作成日**: 2025年10月30日
**バージョン**: 1.0
**プロジェクト**: 3-2-1-1-0 バックアップ管理システム
